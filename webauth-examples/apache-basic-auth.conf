# Example Apache configuration for simple-mcp with Basic Authentication and TLS.
#
# Requirements:
# - mod_ssl
# - mod_proxy
# - mod_proxy_http
# - mod_proxy_wstunnel (if using WebSockets)
#
# To create the .htpasswd file:
#   sudo htpasswd -c /etc/apache2/.htpasswd user1

<VirtualHost *:443>
    ServerName mcp.example.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/mcp.example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/mcp.example.com/privkey.pem

    <Location />
        # Basic Authentication
        AuthType Basic
        AuthName "Restricted MCP Access"
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user

        # Proxy to simple-mcp
        ProxyPass http://localhost:8080/
        ProxyPassReverse http://localhost:8080/

        # Headers for proxying
        ProxyPreserveHost On
        RequestHeader set X-Forwarded-Proto "https"

        # Disable buffering for SSE
        SetEnv force-proxy-forward-1.0 1
        SetEnv proxy-nokeepalive 1
        FlushPackets on
    </Location>

    # Handle WebSockets if needed
    # ProxyPass "/mcp" "ws://localhost:8080/mcp"
</VirtualHost>
