# Example Apache configuration for simple-mcp with OpenID Connect.
#
# Requirements:
# - mod_auth_openidc

<VirtualHost *:443>
    ServerName mcp.example.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/mcp.example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/mcp.example.com/privkey.pem

    # OIDC Configuration
    OIDCCryptoPassphrase a-long-secret-phrase
    OIDCMetadataDir /var/cache/apache2/mod_auth_openidc/metadata
    OIDCRedirectURI https://mcp.example.com/redirect_uri
    OIDCClientID your-client-id
    OIDCClientSecret your-client-secret
    OIDCProviderMetadataURL https://accounts.google.com/.well-known/openid-configuration

    <Location />
        # Authentication
        AuthType openid-connect
        Require valid-user

        # Proxy to simple-mcp
        ProxyPass http://localhost:8080/
        ProxyPassReverse http://localhost:8080/

        ProxyPreserveHost On

        # Disable buffering for SSE
        SetEnv force-proxy-forward-1.0 1
        SetEnv proxy-nokeepalive 1
        FlushPackets on
    </Location>
</VirtualHost>
